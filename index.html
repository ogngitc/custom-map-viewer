<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>下仁田ジオパーク 現在地マップ</title>
  <style>
    canvas { border: 1px solid #ccc; }
    body { font-family: sans-serif; }
  </style>
</head>
<body>
  <h1>下仁田ジオパークの現在地マップ</h1>
  <canvas id="mapCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById("mapCanvas");
    const ctx = canvas.getContext("2d");

    // 地図画像（GitHub Pagesでも相対パスでOK）
    const mapImage = new Image();
    mapImage.src = "shimonita_giopark.jpg"; // 画像ファイルと同じ場所に置く

    // 下仁田周辺の緯度経度範囲（例として設定）
    const latTop = 36.2, latBottom = 36.0;
    const lngLeft = 138.7, lngRight = 138.9;

    function latLngToXY(lat, lng) {
      const x = ((lng - lngLeft) / (lngRight - lngLeft)) * canvas.width;
      const y = ((latTop - lat) / (latTop - latBottom)) * canvas.height;
      return { x, y };
    }

    function drawTearDropMarker(x, y) {
      const radius = 12;

      // ● 円（上部）
      ctx.beginPath();
      ctx.arc(x, y, radius, 0, Math.PI * 2);
      ctx.fillStyle = "red";
      ctx.fill();

      // ▼ 三角形（下部）
      ctx.beginPath();
      ctx.moveTo(x - radius * 0.6, y + radius * 0.2);
      ctx.lineTo(x + radius * 0.6, y + radius * 0.2);
      ctx.lineTo(x, y + radius * 1.8);
      ctx.closePath();
      ctx.fill();

      // ラベル
      ctx.fillStyle = "black";
      ctx.font = "14px sans-serif";
      ctx.fillText("現在地", x + 14, y + 4);
    }

    mapImage.onload = function () {
      ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            const { x, y } = latLngToXY(latitude, longitude);
            drawTearDropMarker(x, y);
          },
          (err) => {
            alert("位置情報の取得に失敗：" + err.message);
          }
        );
      } else {
        alert("このブラウザでは位置情報が使用できません");
      }
    };

    mapImage.onerror = function () {
      alert("地図画像の読み込みに失敗しました。ファイル名を確認してください。");
    };
  </script>
</body>
</html>
